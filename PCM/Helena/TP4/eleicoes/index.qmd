---
title: "Legislativas 2025 — Dashboard"
format:
  html:
    theme: cosmo
    toc: false
    page-layout: full
---

# Legislativas 2025 — Dashboard

Este dashboard é feito em **Quarto + JavaScript**.\
No Visual Mode do VS Code podes editar este texto à vontade.\
Os elementos do dashboard (mapas, tabela, gráfico) são criados em JavaScript.

Quando renderizares o documento, vão aparecer:

-   Mapa do partido mais votado
-   Mapa de intensidade por partido
-   Tabela de resultados
-   Gráfico sunburst

------------------------------------------------------------------------

\`\`\`{javascript} // 1) Carregar bibliotecas (Leaflet, jQuery, DataTables, Plotly)

// Leaflet (mapas) let leafletCSS = document.createElement("link"); leafletCSS.rel = "stylesheet"; leafletCSS.href = "https://unpkg.com/leaflet\@1.9.4/dist/leaflet.css"; document.head.appendChild(leafletCSS);

let leafletJS = document.createElement("script"); leafletJS.src = "https://unpkg.com/leaflet\@1.9.4/dist/leaflet.js"; document.head.appendChild(leafletJS);

// jQuery + DataTables let dtCSS = document.createElement("link"); dtCSS.rel = "stylesheet"; dtCSS.href = "https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css"; document.head.appendChild(dtCSS);

let jqueryJS = document.createElement("script"); jqueryJS.src = "https://code.jquery.com/jquery-3.7.1.min.js"; document.head.appendChild(jqueryJS);

let dtJS = document.createElement("script"); dtJS.src = "https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"; document.head.appendChild(dtJS);

// Plotly (sunburst) let plotlyJS = document.createElement("script"); plotlyJS.src = "https://cdn.plot.ly/plotly-latest.min.js"; document.head.appendChild(plotlyJS);

// 2) Quando a página estiver pronta, criamos os elementos do dashboard em JS

window.addEventListener("load", async () =\> {

// Criar os contentores em HTML via JavaScript const container = document.querySelector("main") \|\| document.body;

const tituloMapa1 = document.createElement("h2"); tituloMapa1.textContent = "Mapa — Partido Mais Votado"; container.appendChild(tituloMapa1);

const mapVencedorDiv = document.createElement("div"); mapVencedorDiv.id = "map-vencedor"; mapVencedorDiv.style.height = "400px"; mapVencedorDiv.style.marginBottom = "20px"; container.appendChild(mapVencedorDiv);

const tituloMapa2 = document.createElement("h2"); tituloMapa2.textContent = "Mapa — Intensidade por Partido"; container.appendChild(tituloMapa2);

const selectPartido = document.createElement("select"); selectPartido.id = "dropdownPartido"; selectPartido.style.marginBottom = "10px"; container.appendChild(selectPartido);

const mapIntDiv = document.createElement("div"); mapIntDiv.id = "map-intensidade"; mapIntDiv.style.height = "400px"; container.appendChild(mapIntDiv);

const tituloTabela = document.createElement("h2"); tituloTabela.textContent = "Tabela de Resultados"; container.appendChild(tituloTabela);

const table = document.createElement("table"); table.id = "tabela"; table.style.width = "100%"; container.appendChild(table);

const tituloSun = document.createElement("h2"); tituloSun.textContent = "Gráfico Sunburst"; container.appendChild(tituloSun);

const sunDiv = document.createElement("div"); sunDiv.id = "sunburst"; sunDiv.style.height = "500px"; container.appendChild(sunDiv);

// 3) Carregar dados (ajusta os caminhos se for preciso) const geojson = await fetch("data/ContinenteDistritos_geo.geojson").then(r =\> r.json()); const resultadosRaw = await fetch("data/2025_ar_mapa_resultados.json").then(r =\> r.json());

// 4) Transformar resultados (igual ao que já tinhas) const circulos = resultadosRaw\[0\]; const circleIds = Object.keys(circulos); const metaLabels = \[ "Inscritos","Votantes","Brancos","Nulos", "Votos Val. Exp. (VVE)","Abstenção", "% / INSC","% / VVE\*" \];

let partidos = \[\];

for (let i = 1; i \< resultadosRaw.length; i++) { const obj = resultadosRaw\[i\];

```         
if (!obj.Círculo) continue;
if (obj.Column2 !== "Número") continue;
if (metaLabels.includes(obj.Círculo)) continue;

const partido = obj.Círculo;

circleIds.forEach(id => {
  let distrito = circulos[id];
  let votos = Number(obj[id]);
  if (!isNaN(votos)) {
    partidos.push({ circulo: distrito, partido, votos });
  }
});
```

}

// 5) Calcular vencedor por distrito let vencedorPorDistrito = {}; partidos.forEach(r =\> { if (!vencedorPorDistrito\[r.circulo\] \|\| r.votos \> vencedorPorDistrito\[r.circulo\].votos) { vencedorPorDistrito\[r.circulo\] = { partido: r.partido, votos: r.votos }; } });

// 6) Cores por partido const partyColors = { "PS": "#E41A1C", "PPD/PSD.CDS-PP": "#FF7F00", "CH": "#377EB8", "IL": "#4DAF4A", "B.E.": "#984EA3", "PCP-PEV": "#A50F15", "L": "#33A02C", "PAN": "#1B9E77", "JPP": "#E6AB02", "ADN": "#7570B3", "NC": "#A6761D", "ND": "#6A3D9A", "PLS": "#B15928", "PCTP/MRPP": "#FB9A99", "PPM": "#CAB2D6", "R.I.R.": "#FFFF99", "VP": "#8DD3C7" };

const getColor = p =\> partyColors\[p\] \|\| "#CCCCCC";

// 7) Mapa vencedor const mapWinner = L.map("map-vencedor").setView(\[39.5, -8\], 6); L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(mapWinner);

L.geoJSON(geojson, { style: f =\> ({ fillColor: getColor(vencedorPorDistrito\[f.properties.NOME\]?.partido), fillOpacity: 0.8, color: "#000", weight: 1 }), onEachFeature: (feature, layer) =\> { const d = vencedorPorDistrito\[feature.properties.NOME\]; if (!d) return; layer.bindTooltip( `<b>${feature.properties.NOME}</b><br>          Vencedor: ${d.partido}<br>          Votos: ${d.votos}` ); } }).addTo(mapWinner);

// 8) Dropdown de partidos \[...new Set(partidos.map(p =\> p.partido))\] .sort() .forEach(p =\> { const opt = document.createElement("option"); opt.value = opt.textContent = p; selectPartido.appendChild(opt); });

// 9) Mapa de intensidade const mapInt = L.map("map-intensidade").setView(\[39.5, -8\], 6); L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(mapInt);

function desenharIntensidade(pSel) { mapInt.eachLayer(l =\> l instanceof L.GeoJSON && mapInt.removeLayer(l));

```         
const votosPorCir = {};
partidos.filter(p => p.partido === pSel)
        .forEach(r => votosPorCir[r.circulo] = r.votos);

L.geoJSON(geojson, {
  style: f => {
    const votos = votosPorCir[f.properties.NOME] || 0;
    const op = Math.min(0.1 + votos / 120000, 0.9);
    return {
      fillColor: "#6A3D9A",
      fillOpacity: op,
      color: "black",
      weight: 1
    };
  },
  onEachFeature: (feature, layer) => {
    const votos = votosPorCir[feature.properties.NOME] || 0;
    layer.bindTooltip(
      `<b>${feature.properties.NOME}</b><br>
       Votos em ${pSel}: ${votos}`
    );
  }
}).addTo(mapInt);
```

}

selectPartido.addEventListener("change", e =\> { desenharIntensidade(e.target.value); }); desenharIntensidade(selectPartido.value);

// 10) Tabela (DataTables) \$(document).ready(() =\> { \$("#tabela").DataTable({ data: partidos, columns: \[ { title: "Círculo", data: "circulo" }, { title: "Partido", data: "partido" }, { title: "Votos", data: "votos" } \], pageLength: 15 }); });

// 11) Sunburst (Plotly) const fig = \[{ type: "sunburst", labels: partidos.map(p =\> p.circulo), parents: partidos.map(p =\> p.partido), values: partidos.map(p =\> p.votos) }\];

Plotly.newPlot("sunburst", fig, { title: "Distribuição de votos por partido e círculo" });

});