---
title: "Audio Content Dashboard"
format: 
  dashboard:
    theme: dark
    orientation: rows
---
```{ojs}
//| output: false

// =================================================================
// 1. ESTILO GLOBAL (CSS) & CONFIGURA√á√ïES
// =================================================================
html`
<style>
  /* Vari√°veis de Cores */
  :root {
    --bg-main: #c1c7cfff;
    --bg-card: #475d99ff;
    --bg-hover: #283881ff;
    --text-primary: #FFFFFF;
    --text-secondary: #B3B3B3;
    --accent: #204250ff;
    --border: #333333;
  }

  /* 1. FUNDO PRETO GLOBAL */
  body, .page-columns, .quarto-content, #quarto-content, .dashboard-card {
    background-color: var(--bg-main) !important;
    color: var(--text-primary) !important;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  }

  /* --- CORRE√á√ÉO DOS FUNDOS BRANCOS (OJS/QUARTO) --- */
  /* Isto remove o fundo branco dos pain√©is padr√£o do Quarto */
  .card, .bslib-card, .bslib-grid-item, .card-body, .html-fill-container {
    background-color: transparent !important; /* Deixa ver o preto de tr√°s */
    border: none !important; /* Remove bordas padr√£o feias */
    box-shadow: none !important;
  }
  
  /* Garante que o texto dentro dos cart√µes padr√£o seja branco */
  .card-body {
    color: var(--text-primary) !important;
  }

  /* 2. SCROLLBAR PERSONALIZADA */
  ::-webkit-scrollbar { width: 8px; }
  ::-webkit-scrollbar-track { background: var(--bg-main); }
  ::-webkit-scrollbar-thumb { background: #444; border-radius: 10px; }
  ::-webkit-scrollbar-thumb:hover { background: #1d80b9ff; }
  /* 3. DROPDOWN ESCURO */
  form select {
    background-color: var(--bg-hover) !important;
    color: white !important;
    border: 1px solid var(--border) !important;
    padding: 8px;
    border-radius: 6px;
    width: 100%;
  }
  
  /* Remove margens extras que criam espa√ßos brancos */
  .dashboard-card {
    margin: 0 !important;
  }

  /* --- 4. CORRE√á√ÉO DA BARRA AZUL (CABE√áALHO) --- */
  .quarto-dashboard-header, .navbar {
    background-color: #5d9edbff !important; /* For√ßa o fundo preto */
    color: white !important;
  }
  
  /* Garante que o t√≠tulo "Audio Analytics..." fica branco */
  .navbar-brand, .navbar-title {
    color: white !important;
  }

</style>
`
```

```{ojs}
//| output: false
// 1. CARREGAR DADOS LOCAIS (Sem erros de API!)
data = FileAttachment("data.json").json()
```

## row {width=40%}

### M√©tricas Principais

```{ojs}
//| echo: false
// Player do Spotify (Usa o ID que pusemos no JSON)
html`<iframe 
  style="border-radius:12px" 
  src=${`https://open.spotify.com/embed/track/${current.id}?utm_source=generator`}
  width="100%" 
  height="350" 
  frameBorder="0" 
  allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
  loading="lazy">
</iframe>`

// 1. Fun√ß√£o auxiliar para converter ms em mm:ss
millisToMinutesAndSeconds = (millis) => {
  if (!millis) return "-";
  var minutes = Math.floor(millis / 60000);
  var seconds = ((millis % 60000) / 1000).toFixed(0);
  return minutes + ":" + (seconds < 10 ? '0' : '') + seconds;
}

// 2. Fun√ß√£o para criar os "cart√µes" de informa√ß√£o
createTag = (label, value, icon = "") => {
  return html`
    <div style="
      background: #5d9edbff; 
      padding: 8px; 
      border-radius: 6px; 
      border: 1px solid #080808ff; 
      display: flex; 
      flex-direction: column; 
      justify-content: center;">
      
      <div style="font-size: 0.75rem; color: #020202ff; margin-bottom: 4px; text-transform: uppercase;">${label}</div>
      <div style="font-size: 1.1rem; font-weight: 600; color: white;">
        ${icon} ${value || "-"}
      </div>
    </div>
  `
}
```

## row {width=80%}

```{ojs}
//| output: false
// L√≥gica: Se n√£o selecionares nada, mostra a primeira
current = selection ? selection : data[0]
```
```{ojs}
//lista das musicas
// Tabela Interativa (Lista de M√∫sicas)
viewof selection = {
  // 1. Criamos um contentor para a lista
  const container = html`<div style="display: flex; flex-direction: column; gap: 8px; max-height: 900px; overflow-y: auto;"></div>`;
  
  // 2. Definimos o valor inicial (primeira m√∫sica)
  container.value = data[0];

  // 3. Criamos o visual de cada m√∫sica
  for (const song of data) {
    const row = html`
      <div style="
        display: flex; 
        align-items: center; 
        padding: 10px; 
        background: #2b2b2b; 
        border-radius: 8px; 
        cursor: pointer; 
        color: white; 
        transition: background 0.2s;">
        
        <img src="${song.img}" style="width: 50px; height: 50px; border-radius: 4px; margin-right: 15px; object-fit: cover;">
        
        <div>
          <div style="font-weight: bold; font-size: 1.1em;">${song.M√∫sica}</div>
          <div style="opacity: 0.7; font-size: 0.9em;">${song.Artista}</div>
        </div>
      </div>
    `;

    // 4. L√≥gica do Clique
    row.onclick = (event) => {
      // Remove o destaque das outras linhas (opcional, visual simples)
      for (const child of container.children) child.style.background = "#2b2b2b";
      
      // Destaca a linha clicada
      row.style.background = "#5d9edbff"; // Verde Spotify
      
      // Atualiza o valor para o OJS
      container.value = song;
      container.dispatchEvent(new Event("input", {bubbles: true}));
    };

    container.append(row);
  }

  return container;
}
```



## row {width=40%}-
### üìù Letras da M√∫sica

```{ojs}
//| echo: false

// 2. INTERFACE COM SCROLL MANUAL (Sem anima√ß√µes verdes/vermelhas)
html`
<div id="lyrics-window" style="
  height: 500px; 
  overflow-y: auto; 
  background: #000000; 
  border-radius: 12px; 
  border: 1px solid #333;
  padding: 40px;
  color: #ffffff;
  font-size: 1.3rem;
  line-height: 1.8;
  text-align: center;
">
  <div style="margin-bottom: 30px; border-bottom: 1px solid #222; padding-bottom: 20px;">
    <h2 style="color: #5d9edbff; margin: 0; font-size: 1.8rem;">${current.M√∫sica}</h2>
    <p style="color: #5d9edbff; margin: 5px 0;">${current.Artista}</p>
  </div>
  
  <div style="white-space: pre-wrap; font-family: 'Inter', sans-serif;">
    ${current.Lyrics ? current.Lyrics : "Letra n√£o encontrada para esta m√∫sica."}
  </div>
</div>

<style>
  /* Customiza√ß√£o da barra de scroll para ser discreta */
  #lyrics-window::-webkit-scrollbar { width: 6px; }
  #lyrics-window::-webkit-scrollbar-track { background: #000; }

</style>
`
```